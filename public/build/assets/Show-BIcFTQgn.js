import{g as e,r as t,D as a,o as s,c as l,a as n,d as o,k as r,t as d,f as i,F as c,m as u,p as m,q as p,G as v,A as y,B as b}from"./vendor-DCAUJ3rR.js";import{a as h}from"./data-C-1G2k3o.js";import{_ as f}from"./app-qKM5zJFL.js";import"./ui-qR5y7ijB.js";const g={class:"container-xxl container-p-y flex-grow-1"},x={class:"card"},w={class:"vendor-header"},k={style:{"font-size":"25px","margin-bottom":"0px","padding-bottom":"0px"}},D={class:"vendor-stats"},V={class:"stat-item"},_={class:"stat-value amount"},C={class:"stat-item"},U={class:"stat-value date"},I={class:"card-body"},S={key:0,class:"text-center py-5"},j={key:1},E={class:"d-flex justify-content-between mb-3"},P=["disabled"],A={key:0,class:"spinner-border spinner-border-sm me-2"},F={key:1,class:"ri-save-line me-1"},L={class:"table-responsive"},N={class:"table table-bordered table-hover"},T=["onUpdate:modelValue"],B=["onUpdate:modelValue"],$=["onUpdate:modelValue","onInput"],q=["onUpdate:modelValue","onInput"],z=["value"],G={class:"table-light"},M={class:"modal-title"},O={class:"modal-body"},H={class:"mb-0"},J=f(e({__name:"Show",props:{vendor:{}},setup(e){const f=e,J=t([]),K=t(!1),Q=t(!1),R=t(!1),W=t(""),X=t(""),Y=t("success"),Z=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),ee=()=>{v.visit(route("vendors.index"))},te=(e,t,a="success")=>{W.value=e,X.value=t,Y.value=a,R.value=!0},ae=()=>{R.value=!1},se=async()=>{try{K.value=!0;const e=await h.get(`/api/vendors/${f.vendor.id}/order-items`);e.data.success&&e.data.data&&(J.value=e.data.data.map(e=>({id:e.id,date:e.created_at?new Date(e.created_at).toISOString().split("T")[0]:"",description:e.item_name,debit:e.purchase_cost||0,credit:e.payment||0,amount:(e.purchase_cost||0)-(e.payment||0)})))}catch(e){J.value=[]}finally{K.value=!1}},le=async()=>{try{if(J.value.filter(e=>!e.date||!e.description||""===e.description.trim()).length>0)return void te("Validation Error","Please fill in Date and Description for all rows before saving.","error");Q.value=!0;const e=J.value.map(e=>({id:e.id,date:e.date,description:e.description.trim(),debit:e.debit||0,credit:e.credit||0,amount:e.amount||0})),t=await h.post(`/api/vendors/${f.vendor.id}/save-payments`,{payments:e});t.data.success?(te("Success!","Payments saved successfully!","success"),await se()):te("Error","Error saving payments: "+t.data.message,"error")}catch(e){te("Error","Error saving payments. Please try again.","error")}finally{Q.value=!1}},ne=()=>{const e=J.value.length>0?Math.max(...J.value.map(e=>e.id))+1:1;J.value.push({id:e,date:"",description:"",debit:0,credit:0,amount:0})},oe=e=>{e.amount=(e=>(e.debit||0)-(e.credit||0))(e)},re=a(()=>J.value.reduce((e,t)=>e+(t.debit||0),0)),de=a(()=>J.value.reduce((e,t)=>e+(t.credit||0),0)),ie=a(()=>re.value-de.value),ce=a(()=>ie.value),ue=a(()=>{if(0===J.value.length)return"No payments yet";const e=J.value[J.value.length-1];return e?e.date:"No payments yet"});return s(async()=>{await se()}),(e,t)=>(n(),l("div",g,[o("div",x,[o("div",w,[o("h1",k,d(e.vendor.name),1),o("div",D,[o("div",V,[t[1]||(t[1]=o("span",{class:"stat-label"},"Last Total Amount:",-1)),o("span",_,d(Z(ce.value)),1)]),o("div",C,[t[2]||(t[2]=o("span",{class:"stat-label"},"Last Payment Date:",-1)),o("span",U,d(ue.value||"No payments yet"),1)])])]),o("div",{class:"card-header d-flex align-items-center justify-content-between",style:{"padding-top":"0px","margin-top":"0px"}},[t[4]||(t[4]=o("h5",{class:"card-header"},"Transactions",-1)),o("button",{onClick:ee,class:"btn btn-secondary"},t[3]||(t[3]=[o("i",{class:"ri-arrow-left-line me-2"},null,-1),i("Back to Vendors ",-1)]))]),o("div",I,[K.value?(n(),l("div",S,t[5]||(t[5]=[o("div",{class:"spinner-border text-primary",role:"status"},[o("span",{class:"visually-hidden"},"Loading...")],-1),o("p",{class:"mt-3 text-muted"},"Loading transactions...",-1)]))):(n(),l("div",j,[o("div",E,[o("div",null,[o("button",{onClick:ne,class:"btn btn-sm btn-success"},t[6]||(t[6]=[o("i",{class:"ri-add-line me-1"},null,-1),i("Add Payment ",-1)]))]),o("div",null,[o("button",{onClick:le,disabled:Q.value,class:"btn btn-primary"},[Q.value?(n(),l("span",A)):(n(),l("i",F)),i(" "+d(Q.value?"Saving...":"Save Payments"),1)],8,P)])]),o("div",L,[o("table",N,[t[8]||(t[8]=o("thead",{class:"table-light"},[o("tr",null,[o("th",{style:{width:"120px"}},"Date"),o("th",{style:{width:"200px"}},"Description"),o("th",{style:{width:"120px"}},"Debit"),o("th",{style:{width:"120px"}},"Credit"),o("th",{style:{width:"120px"}},"Amount")])],-1)),o("tbody",null,[(n(!0),l(c,null,u(J.value,e=>(n(),l("tr",{key:e.id},[o("td",null,[y(o("input",{"onUpdate:modelValue":t=>e.date=t,type:"date",class:"form-control form-control-sm"},null,8,T),[[b,e.date]])]),o("td",null,[y(o("input",{"onUpdate:modelValue":t=>e.description=t,type:"text",class:"form-control form-control-sm",placeholder:"Enter description"},null,8,B),[[b,e.description]])]),o("td",null,[y(o("input",{"onUpdate:modelValue":t=>e.debit=t,type:"number",step:"0.01",class:"form-control form-control-sm",onInput:t=>oe(e),placeholder:"0.00"},null,40,$),[[b,e.debit,void 0,{number:!0}]])]),o("td",null,[y(o("input",{"onUpdate:modelValue":t=>e.credit=t,type:"number",step:"0.01",class:"form-control form-control-sm",onInput:t=>oe(e),placeholder:"0.00"},null,40,q),[[b,e.credit,void 0,{number:!0}]])]),o("td",null,[o("input",{value:Z(e.amount),type:"text",class:m(["form-control form-control-sm",{"text-danger":e.amount<0,"text-success":e.amount>0}]),readonly:""},null,10,z)])]))),128))]),o("tfoot",G,[o("tr",null,[t[7]||(t[7]=o("td",{colspan:"2",class:"text-end"},[o("strong",null,"Totals:")],-1)),o("td",null,[o("strong",null,d(Z(re.value)),1)]),o("td",null,[o("strong",null,d(Z(de.value)),1)]),o("td",null,[o("strong",{class:m({"text-danger":ie.value<0,"text-success":ie.value>0})},d(Z(ie.value)),3)])])])])])]))])]),R.value?(n(),l("div",{key:0,class:"modal-overlay",onClick:ae},[o("div",{class:"modal-content",onClick:t[0]||(t[0]=p(()=>{},["stop"]))},[o("div",{class:m(["modal-header","error"===Y.value?"error-header":"success-header"])},[o("h5",M,[o("i",{class:m(["error"===Y.value?"ri-error-warning-line":"ri-check-line","me-2"])},null,2),i(" "+d(W.value),1)]),o("button",{type:"button",class:"btn-close",onClick:ae})],2),o("div",O,[o("p",H,d(X.value),1)]),o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-secondary",onClick:ae},"Close")])])])):r("",!0)]))}}),[["__scopeId","data-v-4e1efa9f"]]);export{J as default};
