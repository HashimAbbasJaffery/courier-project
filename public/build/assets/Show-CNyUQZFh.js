import{g as e,y as t,r as a,D as s,o as l,n,z as i,c,a as d,d as o,k as r,t as u,f as m,A as v,B as p,F as b,m as h,p as y,q as g,G as f,K as x}from"./vendor-CEpDKWGO.js";import{a as k}from"./data-C-1G2k3o.js";import{_ as w}from"./app-DKrcNuQA.js";import"./ui-B1kR6gEw.js";const D={class:"container-xxl container-p-y flex-grow-1"},S={class:"hero-section"},C={class:"hero-content"},V={class:"hero-left"},R={class:"vendor-info"},U={class:"vendor-name"},Y={class:"stats-section"},_={class:"row g-4"},I={class:"col-md-4"},T={class:"stat-card primary"},E={class:"stat-content"},M={class:"stat-value"},N={class:"col-md-4"},j={class:"stat-card success"},F={class:"stat-content"},A={class:"stat-value"},P={class:"col-md-4"},B={class:"stat-card info"},O={class:"stat-content"},q={class:"stat-value"},G={class:"main-card"},L={class:"filters-section"},z={class:"row align-items-end"},H={class:"col-md-4"},K={class:"transactions-section"},J={class:"section-header"},Q={class:"section-actions"},W={key:0,class:"selection-info"},X={class:"badge bg-primary me-2"},Z={class:"action-buttons"},ee=["disabled"],te={key:0,class:"spinner-border spinner-border-sm me-2"},ae={key:1,class:"ri-save-line me-2"},se={key:0,class:"loading-state"},le={key:1,class:"transactions-table"},ne={class:"table-container"},ie={class:"table table-hover"},ce={class:"table-header text-center",style:{width:"50px"}},de={class:"form-check d-flex justify-content-center"},oe=["checked","indeterminate"],re={class:"checkbox-cell text-center"},ue={class:"form-check d-flex justify-content-center"},me=["id","onUpdate:modelValue"],ve={class:"date-cell"},pe={key:0,class:"edit-input"},be=["onUpdate:modelValue"],he={key:1,class:"display-value"},ye={class:"description-cell"},ge={key:0,class:"edit-input"},fe=["onUpdate:modelValue"],xe={key:1,class:"display-value"},ke={class:"debit-cell text-end"},we={key:0,class:"edit-input"},De=["onUpdate:modelValue","onInput"],Se={key:1,class:"display-value debit-value"},Ce={class:"credit-cell text-end"},Ve={key:0,class:"edit-input"},Re=["onUpdate:modelValue","onInput"],Ue={key:1,class:"display-value credit-value"},Ye={class:"balance-cell text-end"},_e={class:"actions-cell text-center"},Ie=["onClick","title"],Te={class:"totals-row"},$e={class:"text-end"},Ee={class:"total-amount debit-total"},Me={class:"text-end"},Ne={class:"total-amount credit-total"},je={class:"text-end"},Fe={class:"modal-icon"},Ae={class:"modal-title-content"},Pe={class:"modal-title"},Be={class:"modal-subtitle"},Oe=w(e({__name:"Show",props:{vendor:{}},setup(e){const w=e,Oe=t({dateRange:qe()});function qe(){const e=new Date,t=new Date;t.setDate(e.getDate()-7);const a=e=>e.toISOString().split("T")[0];return`${a(t)} - ${a(e)}`}const Ge=a([]),Le=a(!1),ze=a(!1),He=a(new Set);a(new Set);const Ke=a(!1),Je=a(""),Qe=a(""),We=a("success"),Xe=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),Ze=()=>{f.visit(route("vendors.index"))};function et(){Oe.dateRange=qe(),st()}const tt=(e,t,a="success")=>{Je.value=e,Qe.value=t,We.value=a,Ke.value=!0},at=()=>{Ke.value=!1},st=async()=>{try{Le.value=!0;const e={};if(Oe.dateRange&&Oe.dateRange.includes(" - ")){const[t,a]=Oe.dateRange.split(" - ");e.date_from=t,e.date_to=a}const t=await k.get(`/api/vendors/${w.vendor.id}/order-items`,{params:e});t.data.success&&t.data.data&&(Ge.value=t.data.data.map(e=>({id:e.id,date:e.created_at?new Date(e.created_at).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],description:e.item_name||"No description",debit:e.purchase_cost||0,credit:e.payment||0,amount:(e.purchase_cost||0)-(e.payment||0),selected:!1})))}catch(e){Ge.value=[]}finally{Le.value=!1}},lt=async()=>{try{const e=Ge.value.filter(e=>{const t=e.date&&""!==e.date.trim(),a=e.description&&""!==e.description.trim();return!t||!a});if(e.length>0)return void tt("Validation Error",`Please fill in Date and Description for ${e.length} row(s). Invalid rows: ${e.map(e=>e.id).join(", ")}`,"error");ze.value=!0;const t=Ge.value.map(e=>({id:e.id,date:e.date,description:e.description.trim(),debit:e.debit||0,credit:e.credit||0,amount:e.amount||0})),a=await k.post(`/api/vendors/${w.vendor.id}/save-payments`,{payments:t});a.data.success?(tt("Success!","Payments saved successfully!","success"),await st()):tt("Error","Error saving payments: "+a.data.message,"error")}catch(e){tt("Error","Error saving payments. Please try again.","error")}finally{ze.value=!1}},nt=()=>{const e=Ge.value.length>0?Math.max(...Ge.value.map(e=>e.id))+1:1,t={id:e,date:(new Date).toISOString().split("T")[0],description:"New item",debit:0,credit:0,amount:0,selected:!1};Ge.value.push(t),He.value.add(e)},it=()=>{const e=!rt.value;Ge.value.forEach(t=>{t.selected=e}),ct()},ct=()=>{},dt=e=>He.value.has(e),ot=s(()=>0!==Ge.value.length&&Ge.value.every(e=>{const t=e.date&&""!==e.date.trim(),a=e.description&&""!==e.description.trim();return t&&a})),rt=s(()=>Ge.value.length>0&&Ge.value.every(e=>e.selected)),ut=s(()=>{const e=Ge.value.filter(e=>e.selected).length;return e>0&&e<Ge.value.length}),mt=s(()=>Ge.value.filter(e=>e.selected).length),vt=e=>{e.amount=(e=>(e.debit||0)-(e.credit||0))(e)},pt=s(()=>Ge.value.reduce((e,t)=>e+(t.debit||0),0)),bt=s(()=>Ge.value.reduce((e,t)=>e+(t.credit||0),0)),ht=s(()=>pt.value-bt.value),yt=s(()=>ht.value),gt=s(()=>{if(0===Ge.value.length)return"No payments yet";const e=Ge.value[Ge.value.length-1];return e?e.date:"No payments yet"});return l(async()=>{await st(),n(()=>{$("#daterange").daterangepicker({locale:{format:"YYYY-MM-DD"},startDate:moment().subtract(7,"days"),endDate:moment()},function(e,t){Oe.dateRange=`${e.format("YYYY-MM-DD")} - ${t.format("YYYY-MM-DD")}`,st()})})}),i(Oe,async e=>{e.dateRange&&await st()},{deep:!0}),(e,t)=>(d(),c("div",D,[o("div",S,[o("div",C,[o("div",V,[t[3]||(t[3]=o("div",{class:"vendor-avatar"},[o("i",{class:"ri-store-2-line"})],-1)),o("div",R,[o("h1",U,u(e.vendor.name),1),t[2]||(t[2]=o("p",{class:"vendor-subtitle"},"Vendor Account Details",-1))])]),o("div",{class:"hero-actions"},[o("button",{onClick:Ze,class:"btn btn-outline-light btn-lg"},t[4]||(t[4]=[o("i",{class:"ri-arrow-left-line me-2"},null,-1),m("Back to Vendors ",-1)]))])])]),o("div",Y,[o("div",_,[o("div",I,[o("div",T,[t[6]||(t[6]=o("div",{class:"stat-icon"},[o("i",{class:"ri-money-dollar-circle-line"})],-1)),o("div",E,[o("h3",M,u(Xe(yt.value)),1),t[5]||(t[5]=o("p",{class:"stat-label"},"Current Balance",-1))])])]),o("div",N,[o("div",j,[t[8]||(t[8]=o("div",{class:"stat-icon"},[o("i",{class:"ri-calendar-check-line"})],-1)),o("div",F,[o("h3",A,u(gt.value||"No payments yet"),1),t[7]||(t[7]=o("p",{class:"stat-label"},"Last Payment Date",-1))])])]),o("div",P,[o("div",B,[t[10]||(t[10]=o("div",{class:"stat-icon"},[o("i",{class:"ri-file-list-3-line"})],-1)),o("div",O,[o("h3",q,u(Ge.value.length),1),t[9]||(t[9]=o("p",{class:"stat-label"},"Total Transactions",-1))])])])])]),o("div",G,[o("div",L,[o("div",z,[o("div",H,[t[11]||(t[11]=o("label",{class:"form-label fw-semibold text-muted mb-2"},[o("i",{class:"ri-calendar-line me-2"}),m("Date Range ")],-1)),v(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>Oe.dateRange=e),name:"daterange",id:"daterange",class:"form-control form-control-lg"},null,512),[[p,Oe.dateRange]])]),o("div",{class:"col-md-8 text-md-end"},[o("button",{onClick:et,class:"btn btn-outline-secondary me-2"},t[12]||(t[12]=[o("i",{class:"ri-refresh-line me-2"},null,-1),m("Reset Filters ",-1)]))])])]),o("div",K,[o("div",J,[t[15]||(t[15]=o("div",{class:"section-title"},[o("h4",{class:"mb-0"},[o("i",{class:"ri-exchange-line me-2"}),m("Transaction History ")]),o("p",{class:"text-muted mb-0"},"Manage vendor payments and transactions")],-1)),o("div",Q,[mt.value>0?(d(),c("div",W,[o("span",X,[t[13]||(t[13]=o("i",{class:"ri-checkbox-multiple-line me-1"},null,-1)),m(" "+u(mt.value)+" row"+u(1!==mt.value?"s":"")+" selected ",1)])])):r("",!0),o("div",Z,[o("button",{onClick:nt,class:"btn btn-success btn-lg"},t[14]||(t[14]=[o("i",{class:"ri-add-line me-2"},null,-1),m("Add Transaction ",-1)])),o("button",{onClick:lt,disabled:ze.value||!ot.value,class:"btn btn-primary btn-lg ms-3"},[ze.value?(d(),c("span",te)):(d(),c("i",ae)),m(" "+u(ze.value?"Saving...":ot.value?"Save Changes":"Fill Required Fields"),1)],8,ee)])])]),Le.value?(d(),c("div",se,t[16]||(t[16]=[o("div",{class:"loading-content"},[o("div",{class:"loading-spinner"}),o("h5",{class:"mt-3"},"Loading Transactions"),o("p",{class:"text-muted"},"Please wait while we fetch your data...")],-1)]))):(d(),c("div",le,[o("div",ne,[o("table",ie,[o("thead",null,[o("tr",null,[o("th",ce,[o("div",de,[o("input",{class:"form-check-input",type:"checkbox",id:"selectAll",onChange:it,checked:rt.value,indeterminate:ut.value},null,40,oe)])]),t[17]||(t[17]=o("th",{class:"table-header"},[o("i",{class:"ri-calendar-line me-2"}),m("Date ")],-1)),t[18]||(t[18]=o("th",{class:"table-header"},[o("i",{class:"ri-file-text-line me-2"}),m("Description ")],-1)),t[19]||(t[19]=o("th",{class:"table-header text-end"},[o("i",{class:"ri-arrow-down-line me-2"}),m("Debit ")],-1)),t[20]||(t[20]=o("th",{class:"table-header text-end"},[o("i",{class:"ri-arrow-up-line me-2"}),m("Credit ")],-1)),t[21]||(t[21]=o("th",{class:"table-header text-end"},[o("i",{class:"ri-calculator-line me-2"}),m("Balance ")],-1)),t[22]||(t[22]=o("th",{class:"table-header text-center"},[o("i",{class:"ri-settings-3-line me-2"}),m("Actions ")],-1))])]),o("tbody",null,[(d(!0),c(b,null,h(Ge.value,e=>(d(),c("tr",{key:e.id,class:"table-row"},[o("td",re,[o("div",ue,[v(o("input",{class:"form-check-input",type:"checkbox",id:"row-"+e.id,"onUpdate:modelValue":t=>e.selected=t,onChange:ct},null,40,me),[[x,e.selected]])])]),o("td",ve,[dt(e.id)?(d(),c("div",pe,[v(o("input",{"onUpdate:modelValue":t=>e.date=t,type:"date",class:"form-control"},null,8,be),[[p,e.date]])])):(d(),c("div",he,[t[23]||(t[23]=o("i",{class:"ri-calendar-line me-2 text-muted"},null,-1)),m(" "+u(e.date||"No date"),1)]))]),o("td",ye,[dt(e.id)?(d(),c("div",ge,[v(o("input",{"onUpdate:modelValue":t=>e.description=t,type:"text",class:"form-control",placeholder:"Enter description"},null,8,fe),[[p,e.description]])])):(d(),c("div",xe,[t[24]||(t[24]=o("i",{class:"ri-file-text-line me-2 text-muted"},null,-1)),m(" "+u(e.description||"No description"),1)]))]),o("td",ke,[dt(e.id)?(d(),c("div",we,[v(o("input",{"onUpdate:modelValue":t=>e.debit=t,type:"number",step:"0.01",class:"form-control text-end",onInput:t=>vt(e),placeholder:"0.00"},null,40,De),[[p,e.debit,void 0,{number:!0}]])])):(d(),c("div",Se,[t[25]||(t[25]=o("i",{class:"ri-arrow-down-line me-2"},null,-1)),m(" "+u(Xe(e.debit)),1)]))]),o("td",Ce,[dt(e.id)?(d(),c("div",Ve,[v(o("input",{"onUpdate:modelValue":t=>e.credit=t,type:"number",step:"0.01",class:"form-control text-end",onInput:t=>vt(e),placeholder:"0.00"},null,40,Re),[[p,e.credit,void 0,{number:!0}]])])):(d(),c("div",Ue,[t[26]||(t[26]=o("i",{class:"ri-arrow-up-line me-2"},null,-1)),m(" "+u(Xe(e.credit)),1)]))]),o("td",Ye,[o("span",{class:y(["balance-amount",{"text-danger":e.amount<0,"text-success":e.amount>0,"text-muted":0===e.amount}])},[t[27]||(t[27]=o("i",{class:"ri-calculator-line me-2"},null,-1)),m(" "+u(Xe(e.amount)),1)],2)]),o("td",_e,[o("button",{onClick:t=>{return a=e.id,void(He.value.has(a)?He.value.delete(a):He.value.add(a));var a},type:"button",class:y(["btn btn-action",dt(e.id)?"btn-warning":"btn-outline-primary"]),title:dt(e.id)?"Save changes":"Edit row"},[o("i",{class:y(dt(e.id)?"ri-check-line":"ri-edit-line")},null,2)],10,Ie)])]))),128))]),o("tfoot",null,[o("tr",Te,[t[28]||(t[28]=o("td",{class:"text-start"},[o("h6",{class:"mb-0 fw-semibold text-muted"},"Totals")],-1)),t[29]||(t[29]=o("td",null,null,-1)),o("td",$e,[o("span",Ee,u(Xe(pt.value)),1)]),o("td",Me,[o("span",Ne,u(Xe(bt.value)),1)]),o("td",je,[o("span",{class:y(["total-amount balance-total",{"text-danger":ht.value<0,"text-success":ht.value>0,"text-muted":0===ht.value}])},u(Xe(ht.value)),3)]),t[30]||(t[30]=o("td",null,null,-1))])])])])]))])]),Ke.value?(d(),c("div",{key:0,class:"modal-overlay",onClick:at},[o("div",{class:"modal-content",onClick:t[1]||(t[1]=g(()=>{},["stop"]))},[o("div",{class:y(["modal-header","error"===We.value?"error-header":"success-header"])},[o("div",Fe,[o("i",{class:y("error"===We.value?"ri-error-warning-line":"ri-check-line")},null,2)]),o("div",Ae,[o("h5",Pe,u(Je.value),1),o("p",Be,u(Qe.value),1)]),o("button",{type:"button",class:"btn-close",onClick:at},t[31]||(t[31]=[o("i",{class:"ri-close-line"},null,-1)]))],2),o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-primary",onClick:at},t[32]||(t[32]=[o("i",{class:"ri-check-line me-2"},null,-1),m("Got it! ",-1)]))])])])):r("",!0)]))}}),[["__scopeId","data-v-67dd5eea"]]);export{Oe as default};
