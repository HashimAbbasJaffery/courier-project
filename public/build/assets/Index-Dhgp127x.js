import{g as e,r as t,y as a,o as s,n as l,z as n,c as i,a as d,d as r,A as o,B as c,F as p,m as u,k as v,p as m,f as g,t as y,q as b,C as h}from"./vendor-DCAUJ3rR.js";import{a as f}from"./data-C-1G2k3o.js";import{_ as x}from"./app-DDeM6aGO.js";import"./ui-qR5y7ijB.js";const _={key:0,class:"container-xxl container-p-y flex-grow-1"},k={class:"card mb-4 p-3"},w={id:"filterForm"},A={class:"row"},S={class:"col-md-4"},D={class:"col-md-4"},C={id:"origin_city",class:"form-control select2"},R=["value"],z={class:"col-md-4"},T={id:"destination_city",class:"form-control select2"},M=["value"],N={class:"card position-relative"},Y={key:0,class:"px-3 pb-2"},E={key:1,class:"loading-overlay"},O={class:"table-responsive text-nowrap",id:"shipperAdviceTableWrapper"},q={id:"shipperAdviceTable",class:"table-bordered table align-middle",style:{"font-size":"12px"}},I={style:{"text-align":"center","padding-left":"5px","padding-right":"0px"}},j=["checked"],F={id:"shipperAdviceTableBody"},P={style:{"text-align":"center"}},U=["data-id","checked","onChange"],B={style:{"padding-left":"0px","padding-right":"0px"}},V={style:{"padding-left":"5px"}},L={style:{"font-weight":"bold"}},W={style:{"font-size":"10px","background-color":"#faf5ff",padding:"2px 5px","border-radius":"10px","margin-top":"20px",border:"1px solid #ede7f6",color:"#7e57c2"}},H={style:{"padding-left":"0px","padding-right":"0px"}},K={class:"text-truncate",style:{"max-width":"160px","padding-left":"0px"}},X={style:{"font-weight":"bold"}},G={style:{"font-size":"10px","background-color":"#faf5ff",padding:"2px 5px","border-radius":"10px","margin-top":"20px",border:"1px solid #ede7f6",color:"#7e57c2"}},J={style:{"font-size":"12px",width:"10%","padding-left":"0px"}},Q={style:{"margin-bottom":"10px"}},Z={style:{width:"10%","padding-left":"0px","padding-right":"0px","text-align":"center"}},ee={style:{"font-weight":"bold"}},te={style:{"padding-left":"0px"}},ae={style:{"font-weight":"bold"}},se={style:{"padding-left":"0px"}},le={style:{"font-weight":"bold"}},ne={style:{"padding-left":"0px","max-width":"200px"}},ie={style:{"font-size":"11px",color:"#666"}},de={style:{"padding-left":"0px","text-align":"center"}},re={class:"d-flex gap-1 justify-content-center"},oe=["onClick"],ce=["onClick"],pe=["onClick"],ue=["onClick"],ve={key:1,style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column",height:"100vh"}},me={class:"modal fade",id:"shipperAdviceModal",tabindex:"-1","aria-hidden":"true"},ge={class:"modal-dialog modal-dialog-centered modal-sm"},ye={class:"modal-content"},be={class:"modal-body"},he={class:"mb-3"},fe={class:"mb-3"},xe={class:"d-flex gap-2 justify-content-end"},_e=["disabled"],ke={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},we=x(e({__name:"Index",setup(e){const x=t([]),we=t([]),Ae=a({dateRange:"",originCity:"",destination_city:""}),Se=t(!0),De=t(!1),Ce=t(!1),Re=t(null),$e=t([]),ze=t(!1),Te=t(null),Me=a({shipper_advice_status:"",shipper_remarks:""}),Ne=t(!1);function Ye(e){if(!e)return"N/A";const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}-${t.toLocaleString("en-US",{month:"short"})}-${String(t.getFullYear()).slice(-2)}`}const Ee=async()=>{try{De.value=!0,Re.value=null;const e=await f.get("/api/shipper-advices/direct",{params:{from_date:Ae.dateRange.split(" - ")[0]||void 0,origin_city:Ae.originCity||void 0,destination_city:Ae.destination_city||void 0}});"success"===e.data.status||e.data.data?(x.value=e.data.data||[],x.value.length>0&&(Re.value={type:"success",text:`Successfully fetched ${x.value.length} shipper advice records`})):Re.value={type:"error",text:e.data.message||"API returned an error"}}catch(e){Re.value={type:"error",text:"Failed to fetch shipper advice data. Please check your connection and try again."}}finally{De.value=!1}},Oe=()=>{l(()=>{const e=document.querySelectorAll("input.row-check"),t=Array.from(e).map(e=>Number(e.dataset.id)),a=t.length>0&&t.every(e=>$e.value.includes(e));ze.value=a})},qe=()=>{const e="#shipperAdviceTable";$.fn.DataTable.isDataTable(e)&&$(e).DataTable().destroy(),l(()=>{const t=$(e).DataTable({autoWidth:!0,scrollX:!0,columnDefs:[{targets:"_all",className:"align-middle"}]}),a=()=>t.columns.adjust();$(window).on("resize.dt",a),window.addEventListener("orientationchange",a),document.addEventListener("shown.bs.modal",a),document.addEventListener("shown.bs.tab",a),t.on("draw",()=>Oe()),Oe()})};s(async()=>{await(async()=>{try{const e=await f.get(route("courier.cities",{courier:"leopard"}));we.value=e.data.data||[]}catch(e){}})();const e=new Date,t=new Date;t.setDate(e.getDate()-30),Ae.dateRange=`${t.toISOString().split("T")[0]} - ${e.toISOString().split("T")[0]}`,await Ee(),l(()=>{qe(),l(()=>{$("#origin_city").select2().on("select2:open",()=>{je.value=!0}).on("select2:close",()=>{je.value=!1}).on("change",e=>{Ae.originCity=$(e.target).val()}),$("#destination_city").select2().on("select2:open",()=>{je.value=!0}).on("select2:close",()=>{je.value=!1}).on("change",e=>{Ae.destination_city=$(e.target).val()}),$("#daterange").daterangepicker({locale:{format:"YYYY-MM-DD"}},function(e,t){Ae.dateRange=`${e.format("YYYY-MM-DD")} - ${t.format("YYYY-MM-DD")}`})})}),Se.value=!1});let Ie=null,je=t(!1);n(Ae,async e=>{Ie&&clearTimeout(Ie),je.value||Ce.value||(Ie=setTimeout(async()=>{if(e.dateRange&&e.dateRange.includes(" - ")&&!Ce.value){Ce.value=!0;try{await Ee(),qe()}finally{Ce.value=!1}}},800))},{deep:!0});const Fe=async()=>{if(Me.shipper_advice_status)try{Ne.value=!0;const e={api_key:"your_api_key",api_password:"your_api_password",data:[{id:Te.value.id,cn_number:Te.value.tracking_number||Te.value.track_number,shipper_advice_status:Me.shipper_advice_status,shipper_remarks:Me.shipper_remarks}]},t=await f.post("/api/shipper-advice/update",e);"success"===t.data.status?(Re.value={type:"success",text:"Shipper advice updated successfully!"},document.getElementById("hideShipperAdviceModal")?.click(),await Ee()):Re.value={type:"error",text:t.data.message||"Failed to update shipper advice"}}catch(e){Re.value={type:"error",text:"Network error: Failed to update shipper advice"}}finally{Ne.value=!1}else Re.value={type:"error",text:"Please select a status"}},Pe=()=>{const e=document.querySelectorAll("input.row-check"),t=[];if(e.forEach(e=>{const a=Number(e.dataset.id);t.push(a)}),ze.value){const e=new Set(t);$e.value=$e.value.filter(t=>!e.has(t)),ze.value=!1}else{const e=new Set($e.value);t.forEach(t=>e.add(t)),$e.value=Array.from(e),ze.value=!0}},Ue={"Drop Off at Express Center":"drop-off","Shipment Picked":"shipment-picked","Being Return":"being-return","Ready for Return":"ready-for-return",Dispatched:"dispatched",Delivered:"delivered",Pending:"pending",Missroute:"missroute","Returned to shipper":"returned-to-shipper","Arrived at Station":"arrived-at-station","Assign to Courier":"assign-to-courier","Consignment Booked":"consignment-booked",Cancelled:"cancelled","Pickup Request Sent":"pickup-request-sent","48 Hours Auto Canceled":"auto-canceled","Pickup Request not Send":"pickup-request-not-sent"};return(e,t)=>(d(),i(p,null,[Se.value?(d(),i("div",ve,t[26]||(t[26]=[r("span",{class:"loader"},null,-1)]))):(d(),i("div",_,[r("div",k,[r("form",w,[r("div",A,[r("div",S,[t[4]||(t[4]=r("label",null,[r("strong",null,"Date Range:")],-1)),o(r("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>Ae.dateRange=e),name:"daterange",id:"daterange",class:"form-control"},null,512),[[c,Ae.dateRange]])]),r("div",D,[t[6]||(t[6]=r("label",null,[r("strong",null,"Origin City:")],-1)),r("select",C,[t[5]||(t[5]=r("option",{value:""},"All Origins",-1)),(d(!0),i(p,null,u(we.value,e=>(d(),i("option",{key:e.id+"-o",value:e.city},y(e.city),9,R))),128))])]),r("div",z,[t[8]||(t[8]=r("label",null,[r("strong",null,"Destination City:")],-1)),r("select",T,[t[7]||(t[7]=r("option",{value:""},"All Destinations",-1)),(d(!0),i(p,null,u(we.value,e=>(d(),i("option",{key:e.id+"-d",value:e.city},y(e.city),9,M))),128))])])])])]),r("div",N,[Re.value?(d(),i("div",Y,[r("div",{class:m(`alert alert-${"error"===Re.value.type?"danger":"success"===Re.value.type?"success":"info"} alert-dismissible fade show`),role:"alert"},[r("i",{class:m("bi bi-"+("error"===Re.value.type?"exclamation-triangle":"success"===Re.value.type?"check-circle":"info-circle"))},null,2),g(" "+y(Re.value.text)+" ",1),r("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=e=>Re.value=null)})],2)])):v("",!0),De.value?(d(),i("div",E,t[9]||(t[9]=[r("div",{class:"loading-spinner"},null,-1),r("div",{class:"mt-3 text-muted"},"Fetching data...",-1)]))):v("",!0),r("div",O,[r("table",q,[r("thead",null,[r("tr",null,[r("th",I,[r("input",{type:"checkbox",checked:ze.value,onChange:Pe},null,40,j)]),t[10]||(t[10]=r("th",{style:{"font-size":"10px","padding-left":"5px","padding-right":"5px",width:"4%"}},"S.no",-1)),t[11]||(t[11]=r("th",{style:{"font-size":"10px","padding-left":"5px",width:"1%"}},"Tracking #",-1)),t[12]||(t[12]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Status",-1)),t[13]||(t[13]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Customer Name",-1)),t[14]||(t[14]=r("th",{style:{"font-size":"10px","padding-left":"0px",width:"3%"}},"Address",-1)),t[15]||(t[15]=r("th",{style:{"font-size":"10px","padding-left":"0px"},class:"text-center"},"COD Amount",-1)),t[16]||(t[16]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Origin → Destination",-1)),t[17]||(t[17]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Advice Date",-1)),t[18]||(t[18]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Advice Text",-1)),t[19]||(t[19]=r("th",{style:{"font-size":"10px","padding-left":"0px"}},"Actions",-1))])]),r("tbody",F,[(d(!0),i(p,null,u(x.value,(e,a)=>{return d(),i("tr",{key:e.track_number||a},[r("td",P,[r("input",{class:"row-check",type:"checkbox","data-id":e.track_number||a,checked:$e.value.includes(e.track_number||a),onChange:t=>{return s=e.track_number||a,t.target.checked?$e.value.includes(s)||$e.value.push(s):$e.value=$e.value.filter(e=>e!==s),void l(()=>{const e=document.querySelectorAll("input.row-check"),t=Array.from(e).map(e=>Number(e.dataset.id)),a=t.length>0&&t.every(e=>$e.value.includes(e));ze.value=a});var s}},null,40,U)]),r("td",B,y(a+1),1),r("td",V,[r("span",L,y(e.track_number||"—"),1),t[20]||(t[20]=r("br",null,null,-1)),r("span",W,y(Ye(e.booked_packet_date)),1)]),r("td",H,[r("span",{class:m(["badge",Ue[e.booked_packet_status]||"pending"])},y(e.booked_packet_status||"—"),3)]),r("td",K,[r("span",X,y(e.consignment_name_eng||"—"),1),t[21]||(t[21]=r("br",null,null,-1)),r("span",G,y(e.consignment_phone||"-"),1)]),r("td",J,[r("span",Q,y(e.consignment_address||"—"),1)]),r("td",Z,[r("span",ee,y((s=e.booked_packet_collect_amount,s??0===s?new Intl.NumberFormat("en-PK").format(Number(s)):"—"))+"/-",1)]),r("td",te,[r("span",ae,y(e.origin_city_name||"—")+" → "+y(e.destination_city_name||"—"),1)]),r("td",se,[r("span",le,y(Ye(e.advice_date_created)),1)]),r("td",ne,[r("span",ie,y(e.advice_text||"No advice text"),1)]),r("td",de,[r("div",re,[r("button",{onClick:t=>(e=>{Te.value=e,Me.shipper_advice_status="",Me.shipper_remarks="",document.getElementById("shipperAdviceModalOpen")?.click()})(e),class:"btn btn-sm btn-outline-success",title:"Update Shipper Advice"},t[22]||(t[22]=[r("i",{class:"bi bi-plus"},null,-1)]),8,oe),r("button",{onClick:t=>(e=>{Re.value={type:"info",text:`Viewing details for ${e.tracking_number||e.track_number||"N/A"}`}})(e),class:"btn btn-sm btn-outline-primary",title:"View Details"},t[23]||(t[23]=[r("i",{class:"bi bi-eye"},null,-1)]),8,ce),r("button",{onClick:t=>(e=>{Re.value={type:"info",text:`Editing ${e.tracking_number||e.track_number||"N/A"}`}})(e),class:"btn btn-sm btn-outline-warning",title:"Edit"},t[24]||(t[24]=[r("i",{class:"bi bi-pencil"},null,-1)]),8,pe),r("button",{onClick:t=>(e=>{if(confirm(`Are you sure you want to delete ${e.tracking_number||e.track_number||"N/A"}?`)){const t=x.value.findIndex(t=>t.tracking_number===e.tracking_number||t.track_number===e.track_number);t>-1&&(x.value.splice(t,1),Re.value={type:"success",text:"Record deleted successfully"},l(()=>{qe()}))}})(e),class:"btn btn-sm btn-outline-danger",title:"Delete"},t[25]||(t[25]=[r("i",{class:"bi bi-trash"},null,-1)]),8,ue)])])]);var s}),128))])])])])])),r("div",me,[r("div",ge,[r("div",ye,[t[31]||(t[31]=r("div",{class:"modal-header"},[r("h5",{class:"modal-title"},"Update Shipper Advice"),r("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),r("div",be,[r("form",{onSubmit:b(Fe,["prevent"])},[r("div",he,[t[28]||(t[28]=r("label",{for:"shipper_advice_status",class:"form-label"},"Status",-1)),o(r("select",{id:"shipper_advice_status","onUpdate:modelValue":t[2]||(t[2]=e=>Me.shipper_advice_status=e),class:"form-select",required:""},t[27]||(t[27]=[r("option",{value:""},"Select Status",-1),r("option",{value:"RA"},"Re Attempt",-1),r("option",{value:"RT"},"Return",-1)]),512),[[h,Me.shipper_advice_status]])]),r("div",fe,[t[29]||(t[29]=r("label",{for:"shipper_remarks",class:"form-label"},"Remarks",-1)),o(r("textarea",{id:"shipper_remarks","onUpdate:modelValue":t[3]||(t[3]=e=>Me.shipper_remarks=e),class:"form-control",rows:"3",placeholder:"Optional remarks..."},null,512),[[c,Me.shipper_remarks]])]),r("div",xe,[t[30]||(t[30]=r("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),r("button",{type:"submit",class:"btn btn-primary",disabled:Ne.value},[Ne.value?(d(),i("span",ke)):v("",!0),g(" "+y(Ne.value?"Updating...":"Update"),1)],8,_e)])],32)])])])]),t[32]||(t[32]=r("button",{id:"shipperAdviceModalOpen","data-bs-toggle":"modal","data-bs-target":"#shipperAdviceModal",style:{display:"none"}},null,-1)),t[33]||(t[33]=r("button",{id:"hideShipperAdviceModal","data-bs-dismiss":"modal",style:{display:"none"}},null,-1))],64))}}),[["__scopeId","data-v-7ae04712"]]);export{we as default};
